
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>MSSQL复习笔记(上) | XingLiu&#39;s  Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="XingLiu">
    

    
    <meta name="description" content="MSSQL 复习笔记,总结不全，还望指教。">
<meta property="og:type" content="article">
<meta property="og:title" content="MSSQL复习笔记(上)">
<meta property="og:url" content="http://pangjiuzala.github.io/2015/09/10/MSSQL复习笔记-上/index.html">
<meta property="og:site_name" content="XingLiu's  Blog">
<meta property="og:description" content="MSSQL 复习笔记,总结不全，还望指教。">
<meta property="og:updated_time" content="2015-12-01T06:57:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MSSQL复习笔记(上)">
<meta name="twitter:description" content="MSSQL 复习笔记,总结不全，还望指教。">

    
    <link rel="alternative" href="https://github.com/search?q=pangjiuzala&type=Users" title="XingLiu&#39;s  Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="XingLiu&#39;s  Blog" title="XingLiu&#39;s  Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="XingLiu&#39;s  Blog">XingLiu&#39;s  Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">文章列表</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/10/MSSQL复习笔记-上/" title="MSSQL复习笔记(上)" itemprop="url">MSSQL复习笔记(上)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="XingLiu" target="_blank" itemprop="author">XingLiu</a>
		
  <p class="article-time">
    <time datetime="2015-09-10T07:34:45.000Z" itemprop="datePublished"> 发表于 2015-09-10</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是SQL语句"><span class="toc-number">1.</span> <span class="toc-text">什么是SQL语句</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用sql语句创建数据库和表"><span class="toc-number">2.</span> <span class="toc-text">使用sql语句创建数据库和表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建数据表"><span class="toc-number">3.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据完整性约束"><span class="toc-number">4.</span> <span class="toc-text">数据完整性约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四中基本字符类型说明"><span class="toc-number">5.</span> <span class="toc-text">四中基本字符类型说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL基本语句"><span class="toc-number">6.</span> <span class="toc-text">SQL基本语句</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#类型转换函数"><span class="toc-number">7.</span> <span class="toc-text">类型转换函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#日期函数"><span class="toc-number">8.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数学函数"><span class="toc-number">9.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字符串函数"><span class="toc-number">10.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#联合结果集union"><span class="toc-number">11.</span> <span class="toc-text">联合结果集union</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CASE函数用法"><span class="toc-number">12.</span> <span class="toc-text">CASE函数用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IF_ELSE语法"><span class="toc-number">13.</span> <span class="toc-text">IF ELSE语法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WHILE循环语法"><span class="toc-number">14.</span> <span class="toc-text">WHILE循环语法</span></a></li></ol>
		
		</div>
		
		<p>MSSQL 复习笔记,总结不全，还望指教。<br><a id="more"></a></p>
<h1 id="什么是SQL语句">什么是SQL语句</h1><p>sql语言：结构化的查询语言。（Structured Query Language），是关系数据库管理系统的标准语言。</p>
<p>它是一种解释语言：写一句执行一句，不需要整体编译执行。</p>
<p>语法特点：</p>
<p>1.没有“ ”，字符串使用‘ ’包含</p>
<p>2.没有逻辑相等，赋值和逻辑相等都是=</p>
<p>3.类型不再是最严格的。任何数据都可以包含在‘ ’以内</p>
<p>4.没有bool值的概念，但是在视图中可以输入true/false</p>
<p>5.它也有关系运算符：&gt; &lt; &gt;= &lt;= = &lt;&gt; != ,它返回一个bool值</p>
<p>6.它也有逻辑运算符： ！(not) &amp;&amp;(and) ||(or)</p>
<p>7.它不区别大小写</p>
<h1 id="使用sql语句创建数据库和表">使用sql语句创建数据库和表</h1><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> 数据库名称</span><br><span class="line"><span class="keyword">on</span> primary –默认在主文件组上</span><br><span class="line">(</span><br><span class="line"><span class="keyword">name</span>=’逻辑名称_data’ , –当你发现它不是一句完整的<span class="keyword">sql</span>语句，而仅仅是一个处理结构中的某一句的时候，就需要添加 ,</span><br><span class="line"><span class="keyword">size</span>=初始大小,–数值不包含在‘’以内</span><br><span class="line">filegrowth=文件增长 ,</span><br><span class="line"><span class="keyword">maxsize</span>=最大容量,</span><br><span class="line">filename=’物理路径’</span><br><span class="line">)</span><br><span class="line"><span class="keyword">log</span> <span class="keyword">on</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">name</span>=’逻辑名称_log’ , –当你发现它不是一句完整的<span class="keyword">sql</span>语句，而仅仅是一个处理结构中的某一句的时候，就需要添加 ,</span><br><span class="line"><span class="keyword">size</span>=初始大小,–数值不包含在‘’以内</span><br><span class="line">filegrowth=文件增长 ,</span><br><span class="line"><span class="keyword">maxsize</span>=最大容量, –一般来说日志文件不限制最大容量</span><br><span class="line">filename=’物理路径’</span><br><span class="line">)</span></span><br></pre></td></tr></table></figure>
<p>–判断数据库文件是否已经存在 ：数据库的记录都存储在master库中的sysdatabases表中<br>–自动切换当前数据库<br>–使用代码开启外围应该配置器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">'show advanced options'</span> ,<span class="number">1</span></span><br><span class="line">RECONFIGURE</span><br><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">'xp_cmdshell'</span>,<span class="number">1</span></span><br><span class="line">RECONFIGURE</span><br></pre></td></tr></table></figure>
<p>–自定义目录 xp_cmdshell可以创建出目录 ‘mkdir f:\project’：指定创建目录</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exec</span> xp_cmdshell <span class="string">'mkdir f:\project'</span></span><br><span class="line"><span class="keyword">use</span> master</span><br></pre></td></tr></table></figure>
<p>–exists 函数判断（）中的查询语句是否返回结果集，如果返回了结果集则得到true,否则得到false</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">if exists( <span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> sysdatabases <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'School'</span>)</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> School <span class="comment">--删除当前指定名称的数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> School</span><br><span class="line"><span class="keyword">on</span> primary</span><br><span class="line">(</span><br><span class="line"><span class="keyword">name</span>=<span class="string">'School_data'</span>,<span class="comment">--逻辑名称.说明最多能够存储100mb数据，如果没有限制就可以将硬盘存储满</span></span><br><span class="line"><span class="keyword">size</span>=<span class="number">3</span>mb,<span class="comment">--初始大小</span></span><br><span class="line"><span class="keyword">maxsize</span>=<span class="number">100</span>mb,<span class="comment">--最大容量</span></span><br><span class="line">filegrowth=<span class="number">10</span>%,<span class="comment">--文件增长一次增长10%</span></span><br><span class="line">filename=<span class="string">'f:\project\School_data.mdf'</span></span><br><span class="line">),</span></span><br></pre></td></tr></table></figure>
<p>–创建文件组</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">filegroup mygroup</span><br><span class="line">(</span><br><span class="line">name=<span class="string">'School_data1'</span>,<span class="comment">--逻辑名称.说明最多能够存储100mb数据，如果没有限制就可以将硬盘存储满</span></span><br><span class="line">size=<span class="number">3</span>mb,<span class="comment">--初始大小</span></span><br><span class="line">maxsize=<span class="number">100</span>mb,<span class="comment">--最大容量</span></span><br><span class="line">filegrowth=<span class="number">10</span>%,<span class="comment">--文件增长一次增长10%</span></span><br><span class="line">filename=<span class="string">'F:\qiyi\School_data1.ndf'</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">log</span> <span class="command"><span class="keyword">on</span></span></span><br><span class="line">(</span><br><span class="line">name=<span class="string">'School_log'</span>,<span class="comment">--逻辑名称</span></span><br><span class="line">size=<span class="number">3</span>mb,<span class="comment">--初始大小</span></span><br><span class="line"><span class="comment">--maxsize=100mb,--最大容量</span></span><br><span class="line">filegrowth=<span class="number">10</span>%,<span class="comment">--文件增长一次增长10%</span></span><br><span class="line">filename=<span class="string">'f:\project\School_log.ldf'</span></span><br><span class="line">),</span><br><span class="line">(</span><br><span class="line">name=<span class="string">'School_log1'</span>,<span class="comment">--逻辑名称</span></span><br><span class="line">size=<span class="number">3</span>mb,<span class="comment">--初始大小</span></span><br><span class="line"><span class="comment">--maxsize=100mb,--最大容量</span></span><br><span class="line">filegrowth=<span class="number">10</span>%,<span class="comment">--文件增长一次增长10%</span></span><br><span class="line">filename=<span class="string">'F:\qiyi\School_log1.ldf'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="创建数据表">创建数据表</h1><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> 表名</span><br><span class="line">(</span><br><span class="line">字段名称 字段类型 字段特征(是否为<span class="literal">null</span>,默认值 标识列 主键 唯一键 外键 <span class="keyword">check</span>约束),</span><br><span class="line">字段名称 字段类型 字段特征(是否为<span class="literal">null</span>,默认值 标识列 主键 唯一键 外键 <span class="keyword">check</span>约束)</span><br><span class="line">)</span></span><br></pre></td></tr></table></figure>
<p>创建老师表Teacher :Id、Name、Gender、Age、Salary、Birthday</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">use</span> School</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exists</span>(<span class="keyword">select</span> * <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'Classes'</span>)</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> Classes</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Classes</span><br><span class="line">(</span><br><span class="line">Classid <span class="built_in">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">ClassName <span class="keyword">nvarchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exists</span>(<span class="keyword">select</span> * <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'teacher'</span>)</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> teacher</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Teacher</span><br><span class="line">(</span><br><span class="line"><span class="keyword">Id</span> <span class="built_in">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>),<span class="comment">--可以同时创建多个特征，用空格 分隔开。 identity是标识列，第一个参数是种子，第二个是增量</span></span><br><span class="line"><span class="keyword">Name</span> <span class="keyword">nvarchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,<span class="comment">-- not null标记它的值不能为null--不能不填写</span></span><br><span class="line">ClassId <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">Gender <span class="built_in">bit</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">Age <span class="built_in">int</span> ,</span><br><span class="line">Salary money, <span class="comment">--如果不标记为 not null.那么就相当于标记了null</span></span><br><span class="line">Birthday datetime</span><br><span class="line">)</span></span><br></pre></td></tr></table></figure>
<h1 id="数据完整性约束">数据完整性约束</h1><p>实体完整性：实体就是指一条记录。这种完整性就是为了保证每一条记录不是重复记录。是有意义的</p>
<p>– 主键：非空和唯一.一个表只有一个主键，但是一个主键可以是由多个字段组成的 组合键</p>
<p>– 标识列：系统自动生成，永远不重复</p>
<p>– 唯一键：唯一，但是可以为null,只能null一次</p>
<p>域完整性：域就是指字段，它是为了保证字段的值是准和有效，合理值</p>
<p>– 类型 是否null，默认值，check约束，关系</p>
<p>自定义完整性：</p>
<p>– check约束 ， 存储过程 触发器</p>
<p>引用完整性：一个表的某个字段的值是引用自另外一个表的某个字段的值。引用的表就是外键表，被引用的表就是主键表</p>
<p>– 1.建立引用的字段类型必须一致</p>
<p>– 2.建立引用的字段的意义一样</p>
<p>– 3.建立主外键关系的时候选择 外键表 去建立主外键关系</p>
<p>– 4.建立主外键关系的字段在主表中必须是主键或者唯一键</p>
<p>– 5.对于操作的影响 ：</p>
<p>– 1.在添加数据时，先添加主键表再添加外键表数据</p>
<p>– 2.在删除的时候先外键表数据再删除主键表数据</p>
<p>– 级联的操作：不建议使用：会破坏数据完整性</p>
<p>– 不执行任何操作：该报错就报错，该删除就删除</p>
<p>– 级联：删除主表记录，从表引用该值的记录也被删除</p>
<p>– 设置null:删除主表记录，从表对应的字段值设置为null,前提是可以为null</p>
<p>– 设置为default:删除主表记录，从表对应的字段值设置为default,前提是可以为default</p>
<p>主键约束（PK Primary key） 唯一键约束(UQ unique) 外键约束(FK foreign key) 默认值约束(DF default) check约束(CK check)</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> 表名</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> 前缀_约束名称 约束类型 约束说明（字段 关系表达式 值)</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> School</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exists</span>(<span class="keyword">select</span> * <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'PK_Classes_Classid'</span>)</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> classes <span class="keyword">drop</span> <span class="keyword">constraint</span> PK_Classes_Classid</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> classes</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> PK_Classes_Classid primary <span class="keyword">key</span>(classid)</span></span><br></pre></td></tr></table></figure>
<p>–为id添加主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> teacher</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> PK_teacher_id primary <span class="keyword">key</span>(<span class="keyword">id</span>)</span><br><span class="line"><span class="comment">--为name添加唯一键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> UQ_Teacher_Name <span class="keyword">unique</span>(<span class="keyword">Name</span>)</span><br><span class="line"><span class="comment">--同时创建salary的默认约束和age的check约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> DF_Teacher_Salary <span class="keyword">default</span>(<span class="number">5000</span>) <span class="keyword">for</span> salary,</span><br><span class="line"><span class="keyword">constraint</span> CK_Teacher_Age <span class="keyword">check</span>(age&gt;<span class="number">0</span> <span class="keyword">and</span> age&lt;=<span class="number">100</span>)</span><br><span class="line"><span class="comment">--为teacher表的classid字段创建主外键</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exists</span>(<span class="keyword">select</span> * <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'FK_Teacher_Classes_Classid'</span>)</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher <span class="keyword">drop</span> <span class="keyword">constraint</span> FK_Teacher_Classes_Classid</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">nocheck</span> <span class="comment">--不检查现有数据</span></span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> FK_Teacher_Classes_Classid foreign <span class="keyword">key</span>(classid) <span class="keyword">references</span> classes(classid)</span></span><br></pre></td></tr></table></figure>
<p>–on delete set default 级联操作<br>–不执行任何操作：该报错就报错，该删除就删除 –no action –默认选择<br>–级联：删除主表记录，从表引用该值的记录也被删除 –cascade<br>–设置null:删除主表记录，从表对应的字段值设置为null,前提是可以为null –set null<br>–设置为default:删除主表记录，从表对应的字段值设置为default,前提是可以为default –set default</p>
<h1 id="四中基本字符类型说明">四中基本字符类型说明</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--len(参数) --获取指定参数内容的字符个数</span></span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="string">'abcd'</span>) 【<span class="number">4</span>】运行结果</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="string">'中华人民共和国'</span>) 【<span class="number">7</span>】</span><br><span class="line"><span class="comment">--DataLength(参数)：获取指定内占据的字节数--空间大小</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="string">'abcd'</span>) 【<span class="number">4</span>】</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="string">'中华人民共和国'</span>) 【<span class="number">14</span>】</span><br><span class="line"><span class="comment">--char类型：当空间分配后，不会因为存储的内容比分配的空间小就回收分配的空间。但是如果存储的内容超出了指定的空间大小，就会报错，当你存储的内容的长度变化区间不大的时候可以考虑使用char</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="built_in">char</span>) <span class="keyword">from</span> CharTest 【<span class="number">2</span>】</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="built_in">char</span>) <span class="keyword">from</span> CharTest 【<span class="number">10</span>】</span><br><span class="line"><span class="comment">--varchar var--变化的：当你存储的内容小于分配的空间的时候，多余的空间会自动收缩。但是如果存储的内容超出了指定的空间大小，就会报错 当存储的内容波动区间比较大时候使用varchar</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="built_in">varchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">2</span>】</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="built_in">varchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">2</span>】</span><br><span class="line"><span class="comment">--nchar-- n代表它是一个unicode字符。规定不管什么样的字符都占据两个字节。 char:空间是固定的</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="keyword">nchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">10</span>】</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="keyword">nchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">20</span>】</span><br><span class="line"><span class="comment">--nvarchar n var char</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LEN</span>(<span class="keyword">nvarchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">2</span>】</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DataLength</span>(<span class="keyword">nvarchar</span>) <span class="keyword">from</span> CharTest 【<span class="number">4</span>】</span></span><br></pre></td></tr></table></figure>
<h1 id="SQL基本语句">SQL基本语句</h1><p>数据插入</p>
<p>调用方法 一 一对应原则：类型对应，数量对应，顺序对应</p>
<p>语法： 形参 实参</p>
<p>insert into 表名([字段列表]) values(值列表) –数据必须要符合数据完整性</p>
<p>插入操作是单个表的操作</p>
<p>插入操作insert一次只能插入一条记录</p>
<p>use School<br>–插入teacher所有字段的数据.如果在表后没有指定需要插入的字段名称，那么就默认为所有字段添加值<br>–但是一定需要注意的是：标识列永远不能自定义值–不能人为插入值<br>–仅当使用了列列表并且 IDENTITY_INSERT 为 ON 时，才能为表’Teacher’中的标识列指定显式值。<br>i</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">nsert into Teacher <span class="function"><span class="title">values</span><span class="params">(<span class="string">'张三'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">30</span>,<span class="number">4000</span>,<span class="string">'1984-9-11'</span>)</span></span></span><br><span class="line">insert into <span class="function"><span class="title">Teacher</span><span class="params">(Name,ClassId,Gender,Age,Salary,Birthday)</span></span> <span class="function"><span class="title">values</span><span class="params">(<span class="string">'张三'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">30</span>,<span class="number">4000</span>,<span class="string">'1984-9-11'</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>–不为可以为null的字段插入值 :可以null的字段可以不赋值<br>–列名或所提供值的数目与表定义不匹配</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">insert into <span class="function"><span class="title">Teacher</span><span class="params">(Name,ClassId,Gender,Age,Salary)</span></span> <span class="function"><span class="title">values</span><span class="params">(<span class="string">'李四'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">30</span>,<span class="number">4000</span>)</span></span></span><br><span class="line">--非空字段一定需要赋值 ：不能将值 NULL 插入列 <span class="string">'Gender'</span>，表 <span class="string">'School.dbo.Teacher'</span>；列不允许有 Null 值。INSERT 失败</span><br><span class="line">insert into <span class="function"><span class="title">Teacher</span><span class="params">(Name,ClassId,Age,Salary)</span></span> <span class="function"><span class="title">values</span><span class="params">(<span class="string">'李四'</span>,<span class="number">5</span>,<span class="number">30</span>,<span class="number">4000</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>–为有默认值的字段插入值：<br>–1.不写这一列让系统自动赋值</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">insert into <span class="function"><span class="title">Teacher</span><span class="params">(Name,ClassId,Gender,Age)</span></span> <span class="function"><span class="title">values</span><span class="params">(<span class="string">'王五'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">30</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>–指定 null或者default</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> Teacher(<span class="keyword">Name</span>,ClassId,Gender,Age,Salary,Birthday) <span class="keyword">values</span>(<span class="string">'赵六'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">30</span>,<span class="keyword">default</span>,<span class="literal">null</span>)</span></span><br></pre></td></tr></table></figure>
<p>–数据必须完全符合表的完整性约束</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> Teacher(<span class="keyword">Name</span>,ClassId,Gender,Age,Salary,Birthday) <span class="keyword">values</span>(<span class="string">'赵六1'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">300</span>,<span class="keyword">default</span>,<span class="literal">null</span>)</span></span><br></pre></td></tr></table></figure>
<p>–任意类型的数据都可以包含在’’以内, 不包括关键字</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> Teacher(<span class="keyword">Name</span>,ClassId,Gender,Age,Salary,Birthday) <span class="keyword">values</span>(<span class="string">'马鹏飞'</span>,<span class="string">'5'</span>,<span class="string">'0'</span>,<span class="string">'15'</span>,<span class="keyword">default</span>,<span class="literal">null</span>)</span></span><br></pre></td></tr></table></figure>
<p>–但是字符串值如果没有包含在’’以内.会报错 列名 ‘兰鹏’ 无效。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> Teacher(<span class="keyword">Name</span>,ClassId,Gender,Age,Salary,Birthday) <span class="keyword">values</span>(<span class="string">'兰鹏'</span>,<span class="string">'5'</span>,<span class="string">'0'</span>,<span class="string">'15'</span>,<span class="keyword">default</span>,<span class="literal">null</span>)</span></span><br></pre></td></tr></table></figure>
<p>–但是数值组成的字符串可以不使用’’包含</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> Teacher(<span class="keyword">Name</span>,ClassId,Gender,Age,Salary,Birthday) <span class="keyword">values</span>(<span class="number">123</span>,<span class="string">'5'</span>,<span class="string">'0'</span>,<span class="string">'15'</span>,<span class="keyword">default</span>,<span class="literal">null</span>)</span></span><br></pre></td></tr></table></figure>
<p>–日期值必须包含在’‘以内，否则就是默认值</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">insert into <span class="function"><span class="title">Teacher</span><span class="params">(Name,ClassId,Gender,Age,Salary,Birthday)</span></span> <span class="function"><span class="title">values</span><span class="params">(<span class="string">'邹元标2'</span>,<span class="string">'5'</span>,<span class="string">'0'</span>,<span class="string">'15'</span>,default,<span class="string">'1991-9-11'</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>数据删除</p>
<p>语法:</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> [<span class="keyword">from</span>] 表名 <span class="built_in">where</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Teacher <span class="built_in">where</span> Age&lt;<span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>–特点:<br>–1.删除是一条一条进行删除的<br>–2.每一条记录的删除都需要将操作写入到日志文件中<br>–3.标识列不会从种子值重新计算,以从上次最后一条标识列值往下计算<br>–4.这种删除可以触发delete触发器<br>–truncate table 表名 –没有条件，它是一次性删除所有数据<br>–特点：<br>–1.一次性删除所有数据，没有条件，那么日志文件只以最小化的数据写入<br>–2.它可以使用标识列从种子值重新计算<br>–3.它不能触发delete触发器<br>truncate table teacher</p>
<p>数据更新(数据修改)：一定需要考虑是否有条件</p>
<p>语法:</p>
<p>update 表名 set 字段=值，字段=值 。。where 条件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">update</span> Teacher <span class="keyword">set</span> Gender=<span class="string">'true'</span></span></span><br></pre></td></tr></table></figure>
<p>–修改时添加条件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">update</span> Teacher <span class="keyword">set</span> Gender=<span class="number">0</span> <span class="keyword">where</span> <span class="keyword">Id</span>=<span class="number">20</span></span></span><br></pre></td></tr></table></figure>
<p>–多字段修改</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">update Teacher <span class="built_in">set</span> ClassId=<span class="number">4</span>,Age+=<span class="number">5</span>,Salary=<span class="number">5000</span> where Id=<span class="number">22</span></span><br></pre></td></tr></table></figure>
<p>–修改班级id=4，同时年龄》20岁的人员工资+500</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">update Teacher <span class="built_in">set</span> Salary=Salary+<span class="number">500</span> where ClassId=<span class="number">4</span> and Age&gt;<span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>数据检索–查询</p>
<p>语法： *代表所有字段</p>
<p>select */字段名称列表 from 表列表</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select </span>StudentNo,StudentName,Sex,[<span class="keyword">Address] </span>from Student</span><br></pre></td></tr></table></figure>
<p>–可以为标题设置 别名，别名可以是中文别名</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> StudentNo <span class="keyword">as</span> 学号,StudentName 姓名,性别=Sex,[Address] <span class="keyword">from</span> Student</span><br></pre></td></tr></table></figure>
<p>–添加常量列</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> StudentNo <span class="keyword">as</span> 学号,StudentName 姓名,性别=Sex,[Address] ,国籍=<span class="string">'中华人民共和国'</span> <span class="keyword">from</span> Student</span><br></pre></td></tr></table></figure>
<p>–select的作用<br>–1.查询<br>–2.输出<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">select <span class="number">1</span>+<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>–+是运算符,系统会自动为你做类型转换<br><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>+<span class="string">'1'</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">'1'</span>+<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>–如果+两边都是字符串,那么它就是一字符串连接符<br><figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'1'</span>+<span class="string">'1'</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">'a'</span>+<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>–可以输出多列值<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">select <span class="number">1</span>,<span class="number">2</span>,<span class="number">34</span>,<span class="number">3</span>,<span class="number">545</span>,<span class="number">67</span>,<span class="number">567</span>,<span class="number">6</span>,<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p>–Top、Distinct<br><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student</span><br></pre></td></tr></table></figure></p>
<p>–top可以获取指定的记录数,值可以大于总记录数.但是不能是负值<br><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">100</span> * <span class="keyword">from</span> Student</span><br></pre></td></tr></table></figure></p>
<p>–百分比是取ceiling()<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> top <span class="number">10</span> <span class="keyword">percent</span> * <span class="keyword">from</span> Student</span></span><br></pre></td></tr></table></figure></p>
<p>–重复记录与原始的数据表数据无关,只与你查询的结果集有关系 distinct可以去除结果集中的重复记录–结果集中每一列的值都一样</p>
<figure class="highlight nimrod"><table><tr><td class="code"><pre><span class="line">select <span class="keyword">distinct</span> <span class="type">LoginPwd</span>,<span class="type">Sex</span>,<span class="type">Email</span> <span class="keyword">from</span> <span class="type">Student</span></span><br><span class="line">select <span class="keyword">distinct</span> <span class="type">Sex</span> <span class="keyword">from</span> <span class="type">Student</span></span><br></pre></td></tr></table></figure>
<p>–聚合函数：<br>–1.对null过滤<br>–2.都需要有一个参数<br>–3.都是返回一个数值<br>–sum()：求和:只能对数值而言,对字符串和日期无效<br>–avg()：求平均值<br>–count()：计数：得到满足条件的记录数<br>–max()：求最大值:可以对任意类型的数据进行聚合，如果是字符串就比较拼音字母进行排序<br>–min()：求最小值<br>–获取学员总人数<br>select COUNT(*) from Student<br>–查询最大年龄值</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">select</span> <span class="built_in">MIN</span>(BornDate) <span class="keyword">from</span> Student</span><br><span class="line"><span class="built_in">select</span> <span class="built_in">max</span>(BornDate) <span class="keyword">from</span> Student</span><br></pre></td></tr></table></figure>
<p>–查询总分</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">SUM</span>(StudentResult) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> StudentNo=<span class="number">2</span></span></span><br></pre></td></tr></table></figure>
<p>–平均分</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">avg</span>(StudentResult) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=<span class="number">1</span></span></span><br></pre></td></tr></table></figure>
<p>–注意细节：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">SUM</span>(StudentName) <span class="keyword">from</span> Student</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">SUM</span>(BornDate) <span class="keyword">from</span> Student</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(StudentName) <span class="keyword">from</span> Student</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(StudentName) <span class="keyword">from</span> Student</span></span><br></pre></td></tr></table></figure>
<p>–查询学号，姓名，性别，年龄，电话，地址 —查询女生</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> StudentNo,StudentName,Sex,BornDate,Address <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'女'</span> <span class="keyword">and</span> BornDate &gt;<span class="string">'1990-1-1'</span> <span class="keyword">and</span> Address=<span class="string">'广州传智播客'</span></span><br></pre></td></tr></table></figure>
<p>–指定区间范围<br>s</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">elect StudentNo,StudentName,Sex,BornDate,Address <span class="keyword">from</span> Student <span class="keyword">where</span> BornDate &gt;=<span class="string">'1990-1-1'</span> <span class="keyword">and</span> BornDate&lt;=<span class="string">'1993-1-1'</span></span><br><span class="line">--between...<span class="keyword">and</span> &gt;= &lt;=</span><br><span class="line"><span class="keyword">select</span> StudentNo,StudentName,Sex,BornDate,Address <span class="keyword">from</span> Student <span class="keyword">where</span> BornDate between <span class="string">'1990-1-1'</span> <span class="keyword">and</span> <span class="string">'1993-1-1'</span></span><br></pre></td></tr></table></figure>
<p>–查询班级id 1 3 5 7的学员信息</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=<span class="number">1</span> <span class="keyword">or</span> ClassId=<span class="number">3</span> <span class="keyword">or</span> ClassId=<span class="number">5</span> <span class="keyword">or</span> ClassId=<span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>–指定具体的取值范围–可以是任意类型的范围.值的类型需要一致–可以相互转换</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="string">'5'</span>,<span class="number">7</span>)</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId <span class="keyword">not</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="string">'5'</span>,<span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<p>–带条件的查询-模糊查询– 只针对字符串而言<br>–查询 姓 林 的女生信息<br>–=是一种精确查询，需要完全匹配</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'女'</span> <span class="keyword">and</span> StudentName=<span class="string">'林'</span></span><br></pre></td></tr></table></figure>
<p>–通配符–元字符<br>–%：任意个任意字段 window:<em> 正则表达式 ：.</em><br>–_:任意的单个字符<br>–[]:代表一个指定的范围，范围可以是连续也可以是间断的。与正则表达式完全一样[0-9a-zA-Z].可以从这个范围中取一个字符<br>–[^]:取反值</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'女'</span> <span class="keyword">and</span> StudentName=<span class="string">'林%'</span></span><br></pre></td></tr></table></figure>
<p>–通配符必须在模糊查询关键的中才可以做为通配符使用，否则就是普通字符<br>–like 像 。。。。一样</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'女'</span> <span class="keyword">and</span> StudentName <span class="keyword">like</span> <span class="string">'林%'</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'女'</span> <span class="keyword">and</span> StudentName <span class="keyword">like</span> <span class="string">'林_'</span></span></span><br></pre></td></tr></table></figure>
<p>–[]的使用 学号在11~15之间的学员信息</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> Student <span class="keyword">where</span> StudentNo <span class="keyword">like</span> <span class="string">'[13579]'</span></span></span><br></pre></td></tr></table></figure>
<p>—处理null值<br>–null:不是地址没有分配,而是不知道你需要存储什么值 所以null是指 不知道。但是=只能匹配具体的值，而null根本就不是一个值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">COUNT</span>(email) <span class="keyword">from</span> Student <span class="keyword">where</span> Email !=<span class="literal">null</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">COUNT</span>(email) <span class="keyword">from</span> Student <span class="keyword">where</span> Email <span class="keyword">is</span> <span class="literal">null</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(email) <span class="keyword">from</span> Student <span class="keyword">where</span> Email <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span></span><br></pre></td></tr></table></figure>
<p>–将null值替换为指定的字符串值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> StudentName,<span class="keyword">ISNULL</span>(Email,<span class="string">'没有填写电子邮箱'</span>) <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=<span class="number">2</span></span></span><br></pre></td></tr></table></figure>
<p>–当你看到 每一个，，各自，不同，，分别 需要考虑分组<br>–查询每一个班级的男生人数<br>–与聚合函数一起出现在查询中的列，要么也被聚合，要么被分组</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> classid,Sex,<span class="keyword">COUNT</span>(*) <span class="keyword">from</span> Student <span class="keyword">where</span> Sex=<span class="string">'男'</span> <span class="keyword">group</span> <span class="keyword">by</span> ClassId,sex</span></span><br></pre></td></tr></table></figure>
<p>–查询每一个班级的总人数,显示人数&gt;=2的信息<br>–1.聚合不应出现在 WHERE 子句中–语法错误</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> ClassId ,<span class="keyword">COUNT</span>(*) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> Student <span class="keyword">where</span> Email <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">GROUP</span> <span class="keyword">by</span> ClassId <span class="keyword">having</span> <span class="keyword">COUNT</span>(*)&gt;=<span class="number">2</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">num</span> <span class="keyword">desc</span></span></span><br></pre></td></tr></table></figure>
<p>–完整的sql查询家庭<br>–5 1 2 3 4 6<br>–select 字段列表 from 表列表 where 数据源做筛选 group by 分组字段列表 having 分组结果集做筛选 Order by 对结果集做记录重排</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> ClassId ,<span class="keyword">COUNT</span>(*) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> Student <span class="keyword">where</span> Email <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">GROUP</span> <span class="keyword">by</span> ClassId <span class="keyword">order</span> <span class="keyword">by</span> ClassId <span class="keyword">desc</span></span></span><br></pre></td></tr></table></figure>
<p>–关于top的执行顺序 排序之后再取top值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> top <span class="number">1</span> ClassId ,<span class="keyword">COUNT</span>(*) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> Student <span class="keyword">GROUP</span> <span class="keyword">by</span> ClassId <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">num</span> <span class="keyword">desc</span></span></span><br></pre></td></tr></table></figure>
<h1 id="类型转换函数">类型转换函数</h1><p>–select :输出为结果集–虚拟表<br>–print：以文本形式输出 只能输出一个字符串值.<br>print 1+’a’<br>select 1,2<br>select * from Student<br>–类型转换<br>–Convert(目标类型,源数据,[格式]) –日期有格式<br>print ‘我的成绩是：’+convert(char(3),100)<br>print ‘今天是个大日子：’+convert(varchar(30),getdate(),120)<br>select getdate()<br>select len(getdate())<br>–cast(源数据 as 目标类型) 它没有格式<br>print ‘我的成绩是：’+cast(100 as char(3))</p>
<h1 id="日期函数">日期函数</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--getdate():获取当前服务器日期</span></span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">GETDATE</span>()</span><br><span class="line"><span class="comment">--可以在源日期值是追加指定时间间隔的日期数</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DATEADD</span>(dd,-<span class="number">90</span>,<span class="keyword">GETDATE</span>())</span><br><span class="line"><span class="comment">--dateDiff:找到两个日期之间指定格式的差异值</span></span><br><span class="line"><span class="keyword">select</span> StudentName,<span class="keyword">DATEDIFF</span>(yyyy,<span class="keyword">getdate</span>(),BornDate) <span class="keyword">as</span> age <span class="keyword">from</span> Student <span class="keyword">order</span> <span class="keyword">by</span> age</span><br><span class="line"><span class="comment">--DATENAME:可以获取日期的指定格式的字符串表现形式</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DATENAME</span>(dw,<span class="keyword">getdate</span>())</span><br><span class="line"><span class="comment">--DATEPART:可以获取指定的日期部分</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">cast</span>(<span class="keyword">DATEPART</span>(yyyy,<span class="keyword">getdate</span>()) <span class="keyword">as</span> <span class="built_in">CHAR</span>(<span class="number">4</span>))+<span class="string">'-'</span> +<span class="keyword">cast</span>(<span class="keyword">DATEPART</span>(mm,<span class="keyword">getdate</span>()) <span class="keyword">as</span> <span class="built_in">CHAR</span>(<span class="number">2</span>))+<span class="string">'-'</span> +<span class="keyword">cast</span>(<span class="keyword">DATEPART</span>(dd,<span class="keyword">getdate</span>()) <span class="keyword">as</span> <span class="built_in">CHAR</span>(<span class="number">2</span>))</span></span><br></pre></td></tr></table></figure>
<h1 id="数学函数">数学函数</h1><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">--rand:随机数:返回<span class="number">0</span>到<span class="number">1</span>之间的数，理论上说可以返回<span class="number">0</span>但是不能返回<span class="number">1</span></span><br><span class="line">select <span class="function"><span class="title">RAND</span><span class="params">()</span></span></span><br><span class="line">--abs:absolute:取绝对值</span><br><span class="line">select <span class="function"><span class="title">ABS</span><span class="params">(-<span class="number">100</span>)</span></span></span><br><span class="line">--ceiling:获取比当前数大的最小整数</span><br><span class="line">select <span class="function"><span class="title">CEILING</span><span class="params">(<span class="number">1.00</span>)</span></span></span><br><span class="line">--floor:获取比当前数小的最大整数</span><br><span class="line">select <span class="function"><span class="title">floor</span><span class="params">(<span class="number">1.99999</span>)</span></span></span><br><span class="line">power:</span><br><span class="line">select <span class="function"><span class="title">POWER</span><span class="params">(<span class="number">3</span>,<span class="number">4</span>)</span></span></span><br><span class="line">--<span class="function"><span class="title">round</span><span class="params">()</span></span>:四舍五入.只关注指定位数后一位</span><br><span class="line">select <span class="function"><span class="title">ROUND</span><span class="params">(<span class="number">1.549</span>,<span class="number">1</span>)</span></span></span><br><span class="line">--sign:正数==<span class="number">1</span> 负数 ==-<span class="number">1</span> <span class="number">0</span>=<span class="number">0</span></span><br><span class="line">select <span class="function"><span class="title">SIGN</span><span class="params">(-<span class="number">100</span>)</span></span></span><br><span class="line">select <span class="function"><span class="title">ceiling</span><span class="params">(<span class="number">17</span>*<span class="number">1.0</span>/<span class="number">5</span>)</span></span></span><br></pre></td></tr></table></figure>
<h1 id="字符串函数">字符串函数</h1><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">--<span class="number">1</span><span class="class">.CHARINDEX</span> --<span class="function"><span class="title">IndexOf</span><span class="params">()</span></span>:能够返回一个字符串在源字符串的起始位置。找不到就返回<span class="number">0</span>，如果可以找到就返回从<span class="number">1</span>开始的索引--没有数组的概念</span><br><span class="line">--第一个参数是指需要查询的字符串，第二个是源字符串，第三个参数是指从源字符的那个索引位置开始查找</span><br><span class="line">select <span class="function"><span class="title">CHARINDEX</span><span class="params">(<span class="string">'人民'</span>,<span class="string">'中华人民共和国人民'</span>,<span class="number">4</span>)</span></span></span><br><span class="line">--<span class="function"><span class="title">LEN</span><span class="params">()</span></span>：可以返回指定字符串的字符个数</span><br><span class="line">select <span class="function"><span class="title">LEN</span><span class="params">(<span class="string">'中华人民共和国'</span>)</span></span></span><br><span class="line">--<span class="function"><span class="title">UPPER</span><span class="params">()</span></span>:小写字母转换为大写字母 <span class="function"><span class="title">LOWER</span><span class="params">()</span></span>:大写转小写</span><br><span class="line">select <span class="function"><span class="title">LOWER</span><span class="params">(UPPER(<span class="string">'sadfasdfa'</span>)</span></span>)</span><br><span class="line">--LTRIM:去除左空格 RTIRM:去除右空格</span><br><span class="line">select <span class="function"><span class="title">lTRIM</span><span class="params">(RTRIM(<span class="string">' sdfsd '</span>)</span></span>)+<span class="string">'a'</span></span><br><span class="line">--RIGHT:可以从字符串右边开始截取指定位数的字符串 如果数值走出范围，不会报错，只会返回所有字符串值,但是不能是负值</span><br><span class="line">select <span class="function"><span class="title">RIGHT</span><span class="params">(<span class="string">'中华人民共和国'</span>,<span class="number">40</span>)</span></span></span><br><span class="line">select <span class="function"><span class="title">LEFT</span><span class="params">(<span class="string">'中华人民共和国'</span>,<span class="number">2</span>)</span></span></span><br><span class="line">--<span class="function"><span class="title">SUBSTRING</span><span class="params">()</span></span></span><br><span class="line">select <span class="function"><span class="title">SUBSTRING</span><span class="params">(<span class="string">'中华人民共和国'</span>,<span class="number">3</span>,<span class="number">2</span>)</span></span></span><br><span class="line">--REPLACE 第一个参数是源字符串，第二个参数是需要替换的字符串，第三个参数是需要替换为什么</span><br><span class="line">select <span class="function"><span class="title">REPLACE</span><span class="params">(<span class="string">'中华人民共和国'</span>,<span class="string">'人民'</span>,<span class="string">'居民'</span>)</span></span></span><br><span class="line">select <span class="function"><span class="title">REPLACE</span><span class="params">(<span class="string">'中 华 人民 共 和 国'</span>,<span class="string">' '</span>,<span class="string">''</span>)</span></span></span><br><span class="line">--STUFF:将源字符串中从第几个开始，一共几个字符串替换为指定的字符串</span><br><span class="line">select <span class="function"><span class="title">STUFF</span><span class="params">(<span class="string">'中华人民共和国'</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="string">'你懂的'</span>)</span></span></span><br><span class="line">--sudyfsagfyas@<span class="number">12</span>fasdf6<span class="class">.fsadfdsaf</span></span><br><span class="line">declare &lt;<span class="tag">a</span> href=<span class="string">"http://www.jobbole.com/members/Email"</span>&gt;@email&lt;/a&gt; <span class="function"><span class="title">varchar</span><span class="params">(<span class="number">50</span>)</span></span>=<span class="string">'sudyfsagfyas@12fasdf6.fsadfdsaf'</span></span><br><span class="line">select <span class="function"><span class="title">CHARINDEX</span><span class="params">(<span class="string">'@'</span>,@email)</span></span></span><br><span class="line">select <span class="function"><span class="title">LEFT</span><span class="params">(@email,CHARINDEX(<span class="string">'@'</span>,@email)</span></span>-<span class="number">1</span>)</span><br><span class="line">--使用<span class="attribute">right</span></span><br><span class="line">select <span class="function"><span class="title">right</span><span class="params">(@email,len(@email)</span></span>-<span class="function"><span class="title">CHARINDEX</span><span class="params">(<span class="string">'@'</span>,@email)</span></span>)</span><br><span class="line">--使用substring</span><br><span class="line">select <span class="function"><span class="title">SUBSTRING</span><span class="params">(@email,CHARINDEX(<span class="string">'@'</span>,@email)</span></span>+<span class="number">1</span>,<span class="function"><span class="title">LEN</span><span class="params">(@email)</span></span>)</span><br><span class="line">--使用stuff</span><br><span class="line">select <span class="function"><span class="title">STUFF</span><span class="params">(@email,<span class="number">1</span>,CHARINDEX(<span class="string">'@'</span>,@email)</span></span>,<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h1 id="联合结果集union">联合结果集union</h1><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">--联合结果集<span class="class"><span class="keyword">union</span></span></span><br><span class="line">select * from <span class="constant">Student</span> where <span class="constant">Sex</span>=<span class="string">'男'</span></span><br><span class="line">--<span class="class"><span class="keyword">union</span></span></span><br><span class="line">select * from <span class="constant">Student</span> where <span class="constant">Sex</span>=<span class="string">'女'</span></span><br><span class="line">--联合的前提是：</span><br><span class="line">--<span class="number">1</span>.列的数量需要一致:使用 <span class="constant">UNION</span>、<span class="constant">INTERSECT</span> 或 <span class="constant">EXCEPT</span> 运算符合并的所有查询必须在其目标列表中有相同数目的表达式</span><br><span class="line">--<span class="number">2</span>.列的类型需要可以相互转换</span><br><span class="line">select <span class="constant">StudentName</span>,<span class="constant">Sex</span> from <span class="constant">Student</span> --在字符串排序的时候，空格是最小的，排列在最前面</span><br><span class="line"><span class="class"><span class="keyword">union</span></span></span><br><span class="line">select cast(<span class="constant">ClassId</span> <span class="keyword">as</span> <span class="constant">CHAR</span>(<span class="number">3</span>)),classname from grade</span><br><span class="line">--<span class="class"><span class="keyword">union</span>和<span class="title">union</span> <span class="title">all</span>的区别</span></span><br><span class="line">--<span class="class"><span class="keyword">union</span>是去除重复记录的</span></span><br><span class="line">--<span class="class"><span class="keyword">union</span> <span class="title">all</span>不去除重复 ：效率更高，因为不需要判断记录是否重复，也没有必须在结果庥是执行去除重复记录的操作。但是可以需要消耗更多的内存存储空间</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">select * from <span class="constant">Student</span> where <span class="constant">ClassId</span>=<span class="number">2</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">all</span></span></span><br><span class="line">select * from <span class="constant">Student</span> where <span class="constant">ClassId</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>–查询office这科目的全体学员的成绩，同时在最后显示它的平均分，最高分，最低分</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">select <span class="string">' '</span>+cast(<span class="constant">StudentNo</span> <span class="keyword">as</span> <span class="constant">CHAR</span>(<span class="number">3</span>)),cast(<span class="constant">SubjectId</span> <span class="keyword">as</span> <span class="constant">CHAR</span>(<span class="number">2</span>)),<span class="constant">StudentResult</span> from <span class="constant">Result</span> where <span class="constant">SubjectId</span>=<span class="number">1</span></span><br><span class="line"><span class="class"><span class="keyword">union</span></span></span><br><span class="line">select <span class="string">'1'</span>,<span class="string">'平均分'</span>,<span class="constant">AVG</span>(<span class="constant">StudentResult</span>) from <span class="constant">Result</span> where <span class="constant">SubjectId</span>=<span class="number">1</span></span><br><span class="line"><span class="class"><span class="keyword">union</span></span></span><br><span class="line">select <span class="string">'1'</span>,<span class="string">'最高分'</span>,max(<span class="constant">StudentResult</span>) from <span class="constant">Result</span> where <span class="constant">SubjectId</span>=<span class="number">1</span></span><br><span class="line"><span class="class"><span class="keyword">union</span></span></span><br><span class="line">select <span class="string">'1'</span>,<span class="string">'最低分'</span>,min(<span class="constant">StudentResult</span>) from <span class="constant">Result</span> where <span class="constant">SubjectId</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>–一次性插入多条数据<br>–1.先将数据复制到另外一个新表中，删除源数据表，再将新表的数据插入到源数据表中<br>–1.select */字段 into 新表 from 源表<br>–1.新表是系统自动生成的，不能人为创建，如果新表名称已经存在就报错<br>–2.新表的表结构与查询语句所获取的列一致，但是列的属性消失，只保留非空和标识列。其它全部消失，如主键，唯一键，关系，约束，默认值<br><figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">select * into newGrade from grade</span><br><span class="line">truncate table grade</span><br><span class="line">select * from newGrade</span><br><span class="line">--select * into grade from newGrade</span><br><span class="line">--<span class="number">2</span>.insert into 目标表 select 字段列表/* from 数据源表</span><br><span class="line">--<span class="number">1</span>、目标表必须先存在，如果没有就报错</span><br><span class="line">--<span class="number">2</span>.查询的数据必须符合目标表的数据完整性</span><br><span class="line">--<span class="number">3</span>.查询的数据列的数量和类型必须的目标的列的数量和对象完全对应</span><br><span class="line">insert into grade select classname from newGrade</span><br><span class="line">delete from admin</span><br><span class="line">--使用<span class="class"><span class="keyword">union</span>一次性插入多条记录</span></span><br><span class="line">--insert into 表(字段列表)</span><br><span class="line">--select 值。。。。 用户自定义数据</span><br><span class="line">--<span class="class"><span class="keyword">union</span></span></span><br><span class="line">--select 值 。。。。</span><br><span class="line">insert into <span class="constant">Admin</span></span><br><span class="line">select <span class="string">'a'</span>,<span class="string">'a'</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">all</span></span></span><br><span class="line">select <span class="string">'a'</span>,<span class="string">'a'</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">all</span></span></span><br><span class="line">select <span class="string">'a'</span>,<span class="string">'a'</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">all</span></span></span><br><span class="line">select <span class="string">'a'</span>,null</span><br></pre></td></tr></table></figure></p>
<h1 id="CASE函数用法">CASE函数用法</h1><p>相当于switch case—c#中的switch…case只能做等值判断</p>
<p>这可以对字段值或者表达式进行判断，返回一个用户自定义的值，它会生成一个新列</p>
<p>1.要求then后面数据的类型一致</p>
<p>2.第一种做等值判断的case..end<br><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> 字段或者表达式</span><br><span class="line"><span class="keyword">when</span> .值..<span class="keyword">then</span> .自定义值</span><br><span class="line"><span class="keyword">when</span> .值..<span class="keyword">then</span> .自定义值</span><br><span class="line">…..</span><br><span class="line"><span class="keyword">else</span> 如果不满足上面所有的<span class="keyword">when</span>就满足这个<span class="keyword">else</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">--显示具体班级的名称</span><br><span class="line">select StudentNo,StudentName,</span><br><span class="line"><span class="keyword">case</span> ClassId --如果<span class="keyword">case</span>后面接有表达式或者字段，那么这种结构就只能做等值判断，真的相当于<span class="keyword">switch</span>..<span class="keyword">case</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">'一班'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">'2班'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">'3班'</span></span><br><span class="line"><span class="keyword">when</span> <span class="literal">null</span> <span class="keyword">then</span> <span class="string">'aa'</span> --不能判断<span class="literal">null</span>值</span><br><span class="line"><span class="keyword">else</span> <span class="string">'搞不清白'</span></span><br><span class="line">end,</span><br><span class="line">sex</span><br><span class="line"><span class="keyword">from</span> Student</span><br><span class="line">--<span class="number">2.</span>做范围判断，相当于<span class="keyword">if</span>..<span class="keyword">else</span>，它可以做<span class="literal">null</span>值判断</span><br><span class="line">--<span class="keyword">case</span> --如果没有表达式或者字段就可实现范围判断</span><br><span class="line">-- <span class="keyword">when</span> 表达式 <span class="keyword">then</span> 值 --不要求表达式对同一字段进行判断</span><br><span class="line">-- <span class="keyword">when</span> 表达式 <span class="keyword">then</span> 值</span><br><span class="line">-- .....</span><br><span class="line">--<span class="keyword">else</span> 其它情况</span><br><span class="line">--end</span><br><span class="line">select StudentNo,StudentName,</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line"><span class="keyword">when</span> BornDate&gt;<span class="string">'2000-1-1'</span> <span class="keyword">then</span> <span class="string">'小屁孩'</span></span><br><span class="line"><span class="keyword">when</span> BornDate&gt;<span class="string">'1990-1-1'</span> <span class="keyword">then</span> <span class="string">'小青年'</span></span><br><span class="line"><span class="keyword">when</span> BornDate&gt;<span class="string">'1980-1-1'</span> <span class="keyword">then</span> <span class="string">'青年'</span></span><br><span class="line">--<span class="keyword">when</span> Sex=<span class="string">'女'</span> <span class="keyword">then</span> <span class="string">'是女的'</span></span><br><span class="line"><span class="keyword">when</span> BornDate <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">then</span> <span class="string">'出生不详'</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">'中年'</span></span><br><span class="line">end</span><br><span class="line"><span class="keyword">from</span> Student</span><br><span class="line">--百分制转换为素质教育 <span class="number">90</span> -A <span class="number">80</span>--B <span class="number">70</span> --C <span class="number">60</span> --D &lt;<span class="number">60</span> E NULL--没有参加考试</span><br><span class="line">select StudentNo,SubjectId,</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line"><span class="keyword">when</span> StudentResult&gt;=<span class="number">90</span> <span class="keyword">then</span> <span class="string">'A'</span></span><br><span class="line"><span class="keyword">when</span> StudentResult&gt;=<span class="number">80</span> <span class="keyword">then</span> <span class="string">'B'</span></span><br><span class="line"><span class="keyword">when</span> StudentResult&gt;=<span class="number">70</span> <span class="keyword">then</span> <span class="string">'C'</span></span><br><span class="line"><span class="keyword">when</span> StudentResult&gt;=<span class="number">60</span> <span class="keyword">then</span> <span class="string">'D'</span></span><br><span class="line"><span class="keyword">when</span> StudentResult <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">then</span> <span class="string">'没有参加考试'</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">'E'</span></span><br><span class="line">end 成绩,</span><br><span class="line">ExamDate</span><br><span class="line"><span class="keyword">from</span> Result</span><br></pre></td></tr></table></figure></p>
<h1 id="IF_ELSE语法">IF ELSE语法</h1><p>1,.没有｛｝，使用begin..end.如果后面只有一句，可以不使用begin..end包含</p>
<p>2.没有bool值，只能使用关系运算符表达式</p>
<p>3.也可以嵌套和多重</p>
<p>4.if后面的（）可以省略</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">declare</span> @subjectname <span class="keyword">nvarchar</span>(<span class="number">50</span>)=<span class="string">'office'</span> <span class="comment">--科目名称</span></span><br><span class="line"><span class="keyword">declare</span> @subjectId <span class="built_in">int</span>=(<span class="keyword">select</span> Subjectid <span class="keyword">from</span> Subject <span class="keyword">where</span> SubjectName=@subjectname) <span class="comment">--科目ID</span></span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">avg</span> <span class="built_in">int</span> <span class="comment">--平均分</span></span><br><span class="line"><span class="keyword">set</span> @<span class="keyword">avg</span>=(<span class="keyword">select</span> <span class="keyword">AVG</span>(StudentResult) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentResult <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>) <span class="comment">--获取平均分</span></span><br><span class="line">print @<span class="keyword">avg</span></span><br><span class="line"><span class="keyword">if</span> @<span class="keyword">avg</span>&gt;=<span class="number">60</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print <span class="string">'成绩不错，输出前三名：'</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">3</span> * <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">order</span> <span class="keyword">by</span> StudentResult <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print <span class="string">'成绩不好，输出后三名：'</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">3</span> * <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">order</span> <span class="keyword">by</span> StudentResult</span><br><span class="line"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
<h1 id="WHILE循环语法">WHILE循环语法</h1><p>没有{},使用begin..end</p>
<p>没有bool值，需要使用条件表达式</p>
<p>可以嵌套</p>
<p>也可以使用break,continue</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">go</span><br><span class="line"><span class="operator"><span class="keyword">declare</span> @subjectName <span class="keyword">nvarchar</span>(<span class="number">50</span>)=<span class="string">'office'</span> <span class="comment">--科目名称</span></span><br><span class="line"><span class="keyword">declare</span> @subjectId <span class="built_in">int</span><span class="comment">--科目ID</span></span><br><span class="line"><span class="keyword">declare</span> @classid <span class="built_in">int</span> =(<span class="keyword">select</span> classid <span class="keyword">from</span> Subject <span class="keyword">where</span> SubjectName=@subjectName) <span class="comment">--查询当前科目属于那一个班级</span></span><br><span class="line"><span class="keyword">set</span> @subjectId=(<span class="keyword">select</span> SubjectId <span class="keyword">from</span> Subject <span class="keyword">where</span> SubjectName=@subjectName) <span class="comment">--获取科目ID</span></span><br><span class="line"><span class="keyword">declare</span> @totalCount <span class="built_in">int</span> <span class="comment">--总人数 :那一个班级需要考试这一科目</span></span><br><span class="line"><span class="keyword">set</span> @totalCount=(<span class="keyword">select</span> <span class="keyword">COUNT</span>(*) <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid)</span><br><span class="line">print @totalcount <span class="comment">--14</span></span><br><span class="line"><span class="keyword">declare</span> @unpassNum <span class="built_in">int</span> <span class="comment">--不及格人数</span></span><br><span class="line"><span class="keyword">set</span> @unpassNum=(<span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="keyword">distinct</span> Studentno) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentNo <span class="keyword">in</span>(<span class="keyword">select</span> StudentNo <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid) <span class="keyword">and</span> StudentResult&lt;<span class="number">60</span>)</span><br><span class="line"><span class="keyword">while</span>(@unpassNum&gt;@totalCount/<span class="number">2</span>)</span><br><span class="line"><span class="keyword">begin</span></span></span><br></pre></td></tr></table></figure>
<p>–执行循环加分</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">update</span> <span class="keyword">Result</span> <span class="keyword">set</span> StudentResult+=<span class="number">2</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentNo <span class="keyword">in</span>(<span class="keyword">select</span> StudentNo <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid) <span class="keyword">and</span> StudentResult&lt;=<span class="number">98</span></span></span><br></pre></td></tr></table></figure>
<p>–重新计算不及格人数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">set</span> @unpassNum=(<span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="keyword">distinct</span> Studentno) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentNo <span class="keyword">in</span>(<span class="keyword">select</span> StudentNo <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid) <span class="keyword">and</span> StudentResult&lt;<span class="number">60</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">go</span></span><br><span class="line"><span class="keyword">declare</span> @subjectName <span class="keyword">nvarchar</span>(<span class="number">50</span>)=<span class="string">'office'</span> <span class="comment">--科目名称</span></span><br><span class="line"><span class="keyword">declare</span> @subjectId <span class="built_in">int</span><span class="comment">--科目ID</span></span><br><span class="line"><span class="keyword">declare</span> @classid <span class="built_in">int</span> =(<span class="keyword">select</span> classid <span class="keyword">from</span> Subject <span class="keyword">where</span> SubjectName=@subjectName) <span class="comment">--查询当前科目属于那一个班级</span></span><br><span class="line"><span class="keyword">set</span> @subjectId=(<span class="keyword">select</span> SubjectId <span class="keyword">from</span> Subject <span class="keyword">where</span> SubjectName=@subjectName) <span class="comment">--获取科目ID</span></span><br><span class="line"><span class="keyword">declare</span> @totalCount <span class="built_in">int</span> <span class="comment">--总人数</span></span><br><span class="line"><span class="keyword">set</span> @totalCount=(<span class="keyword">select</span> <span class="keyword">COUNT</span>(*) <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid)</span><br><span class="line">print @totalcount <span class="comment">--14</span></span><br><span class="line"><span class="keyword">declare</span> @unpassNum <span class="built_in">int</span> <span class="comment">--不及格人数</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> @unpassNum=(<span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="keyword">distinct</span> Studentno) <span class="keyword">from</span> <span class="keyword">Result</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentNo <span class="keyword">in</span>(<span class="keyword">select</span> StudentNo <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid) <span class="keyword">and</span> StudentResult&lt;<span class="number">60</span>)</span><br><span class="line"><span class="keyword">if</span>(@unpassNum&gt;@totalCount/<span class="number">2</span>)</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">Result</span> <span class="keyword">set</span> StudentResult+=<span class="number">2</span> <span class="keyword">where</span> SubjectId=@subjectId <span class="keyword">and</span> StudentNo <span class="keyword">in</span>(<span class="keyword">select</span> StudentNo <span class="keyword">from</span> Student <span class="keyword">where</span> ClassId=@classid) <span class="keyword">and</span> StudentResult&lt;=<span class="number">98</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">break</span><br><span class="line"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据库/">数据库</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/09/11/MSSQL复习笔记-下/" title="MSSQL复习笔记(下)">
  <strong>上一篇：</strong><br/>
  <span>
  MSSQL复习笔记(下)</span>
</a>
</div>


<div class="next">
<a href="/2015/09/09/Java性能优化-13-支持非可变性/"  title="Java性能优化(13):支持非可变性">
 <strong>下一篇：</strong><br/> 
 <span>Java性能优化(13):支持非可变性
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/09/10/MSSQL复习笔记-上/" data-title="MSSQL复习笔记(上)" data-url="http://pangjiuzala.github.io/2015/09/10/MSSQL复习笔记-上/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是SQL语句"><span class="toc-number">1.</span> <span class="toc-text">什么是SQL语句</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用sql语句创建数据库和表"><span class="toc-number">2.</span> <span class="toc-text">使用sql语句创建数据库和表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建数据表"><span class="toc-number">3.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据完整性约束"><span class="toc-number">4.</span> <span class="toc-text">数据完整性约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四中基本字符类型说明"><span class="toc-number">5.</span> <span class="toc-text">四中基本字符类型说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL基本语句"><span class="toc-number">6.</span> <span class="toc-text">SQL基本语句</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#类型转换函数"><span class="toc-number">7.</span> <span class="toc-text">类型转换函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#日期函数"><span class="toc-number">8.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数学函数"><span class="toc-number">9.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字符串函数"><span class="toc-number">10.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#联合结果集union"><span class="toc-number">11.</span> <span class="toc-text">联合结果集union</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CASE函数用法"><span class="toc-number">12.</span> <span class="toc-text">CASE函数用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IF_ELSE语法"><span class="toc-number">13.</span> <span class="toc-text">IF ELSE语法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WHILE循环语法"><span class="toc-number">14.</span> <span class="toc-text">WHILE循环语法</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=2129798793&verifier=c0951e84&dpc=1"></iframe>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>31</sup></a></li>
			
		
			
				<li><a href="/tags/大数据/" title="大数据">大数据<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/性能优化/" title="性能优化">性能优化<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/数据挖掘/" title="数据挖掘">数据挖掘<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/HBase/" title="HBase">HBase<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/Spark/" title="Spark">Spark<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/机器学习/" title="机器学习">机器学习<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/数据库/" title="数据库">数据库<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/网络爬虫/" title="网络爬虫">网络爬虫<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/移动互联网/" title="移动互联网">移动互联网<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/物联网/" title="物联网">物联网<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/云平台/" title="云平台">云平台<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Taobao-File-System/" title="Taobao File System">Taobao File System<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/智慧医疗/" title="智慧医疗">智慧医疗<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/爬虫/" title="爬虫">爬虫<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/云计算/" title="云计算">云计算<sup>1</sup></a></li>
			
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">25</span></li></ul>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.csdn.net/pangjiuzala" target="_blank" title="My Blog in  CSDN">CSDN</a>
            
          </li>
        
          <li>
            
            	<a href="http://saliormoon.github.io/" target="_blank" title="王宇峰的博客">王宇峰的博客</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.changhuiyuan.com/" target="_blank" title="常惠源的博客">常惠源的博客</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="https://github.com/search?q=pangjiuzala&amp;type=Users" target="_blank" title="关注刘兴的github">关注</a>
</div>

  

  


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello,I&#39;m from ZjuCs! <br/>
			The more you diligent, the more you lucky!</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Copyright@ 2015 Liuxing All rights reserved.
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"pangjiuzala"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffeafc504b70a541dd3845d467335f367' type='text/javascript'%3E%3C/script%3E"));
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_null'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/z_stat.php%3Fid%3Dnull' type='text/javascript'%3E%3C/script%3E"));</script>

<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: '4ac092ad8d749fdc6293'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
</html>
